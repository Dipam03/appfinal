<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shopsy Home (Working Orders)</title>
<style>
  :root { --accent:#0066ff; --muted:#f6f8fa; --glow:rgba(0,102,255,.25); --bg:#fff; --fg:#111; --card:#fff; --border:#eee; --mutetext:#666; }
  [data-theme="dark"] { --bg:#0b0f14; --fg:#e6eef7; --card:#10161d; --border:#1f2a35; --mutetext:#a5b2c1; --glow:rgba(0,102,255,.35); }
  body { margin:0; font-family:system-ui,Segoe UI,Arial; background:var(--bg); color:var(--fg); }
  .header { display:flex; gap:12px; align-items:center; padding:12px 16px; border-bottom:1px solid var(--border); position:sticky; top:0; background:var(--card); z-index:10; }
  .logo { font-weight:700; color:var(--accent); font-size:20px; }
  .search { flex:1; }
  .search input { width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:8px; background:var(--card); color:var(--fg); transition:border-color .3s, box-shadow .3s; }
  .search input:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--glow); outline:0; }

  nav { display:flex; gap:10px; align-items:center; }
  .btn { padding:8px 12px; border:1px solid var(--border); border-radius:999px; background:var(--card); color:var(--fg); cursor:pointer; transition:transform .2s, box-shadow .2s; }
  .btn:hover { transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.06); }
  .primary { background:var(--accent); color:#fff; border-color:var(--accent); }
  .primary:hover { transform:translateY(-1px) scale(1.02); box-shadow:0 8px 24px rgba(0,102,255,.25); }

  .hero { padding:32px 16px; background:linear-gradient(180deg,#eef4ff,transparent); border-bottom:1px solid var(--border); opacity:0; transform:translateY(8px); animation:fadeUp .6s ease .15s forwards; }
  @keyframes fadeUp { to { opacity:1; transform:translateY(0); } }

  section { border-color:var(--border); }
  .grid { display:grid; gap:12px; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); padding:16px; }

  .tile { border:1px solid var(--border); border-radius:12px; background:var(--card); overflow:hidden; transition:transform .2s, box-shadow .2s, border-color .2s; }
  .tile img { width:100%; height:120px; object-fit:cover; background:#1a1a1a10; transition:transform .25s; }
  .tile span { display:block; padding:8px 10px; font-weight:600; }
  .tile:hover { transform:translateY(-4px); box-shadow:0 12px 28px rgba(0,0,0,.08), 0 0 0 4px var(--glow); border-color:transparent; }
  .tile:hover img { transform:scale(1.03); }

  .card { border:1px solid var(--border); border-radius:12px; background:var(--card); overflow:hidden; transition:transform .2s, box-shadow .2s; }
  .card img { width:100%; height:140px; object-fit:cover; background:#1a1a1a10; transition:transform .3s; }
  .card .info { padding:10px; }
  .price { color:#0a7; font-weight:700; }
  .card:hover { transform:translateY(-5px); box-shadow:0 14px 32px rgba(0,0,0,.10); }
  .card:hover img { transform:scale(1.05); }

  .badge { position:relative; top:-6px; margin-left:6px; background:#ff3b30; color:#fff; border-radius:999px; padding:2px 8px; font-size:12px; display:inline-block; }
  .badge.pulse { animation:pulse .5s ease; }
  @keyframes pulse { 0%{ transform:scale(1); } 50%{ transform:scale(1.2); } 100%{ transform:scale(1); } }

  .contact { padding:16px; border-top:1px solid var(--border); }
  .contact form { display:grid; gap:10px; max-width:420px; }
  input, textarea { padding:10px 12px; border:1px solid var(--border); border-radius:8px; font:inherit; background:var(--card); color:var(--fg); }

  .btn .spinner { --sz:16px; width:var(--sz); height:var(--sz); border-radius:50%; border:2px solid rgba(255,255,255,.6); border-top-color:#fff; margin-left:8px; display:none; animation:spin 1s linear infinite; }
  @keyframes spin { to { transform:rotate(360deg); } }
  .btn.loading span.txt { opacity:.6; }
  .btn.loading .spinner { display:inline-block; }

  footer { padding:20px 16px; text-align:center; color:var(--mutetext); border-top:1px solid var(--border); }

  /* Account modal */
  .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:1000; }
  .modal { width:100%; max-width:520px; background:var(--card); color:var(--fg); border-radius:14px; box-shadow:0 24px 64px rgba(0,0,0,.25); overflow:hidden; transform:translateY(12px); opacity:0; animation:fadeUp .25s ease forwards; }
  .modal header { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border); }
  .modal h3 { margin:0; font-size:18px; }
  .modal .close { border:none; background:transparent; font-size:22px; cursor:pointer; line-height:1; color:var(--fg); }
  .tabs { display:flex; gap:6px; padding:8px; border-bottom:1px solid var(--border); flex-wrap:wrap; }
  .tabs button { flex:1; padding:8px; border-radius:999px; border:1px solid var(--border); background:var(--card); color:var(--fg); cursor:pointer; }
  .tabs button.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  .panel { display:none; padding:14px; }
  .panel.active { display:block; }
  .row { display:grid; gap:8px; margin-bottom:12px; }
  .row input { padding:10px 12px; border:1px solid var(--border); border-radius:8px; background:var(--card); color:var(--fg); }
  .muted { color:var(--mutetext); font-size:13px; }
  .alert { background:#fef3c7; border:1px solid #fde68a; color:#92400e; padding:8px 10px; border-radius:8px; margin:10px 14px; display:none; }
  .alert.show { display:block; }

  /* Cart drawer */
  .cart-toggle { position:relative; }
  .cart-drawer-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.4); display:none; z-index:1100; }
  .cart-drawer { position:fixed; top:0; right:0; height:100%; width:360px; max-width:92vw; background:var(--card); color:var(--fg); box-shadow:-16px 0 40px rgba(0,0,0,.18); transform:translateX(100%); transition:transform .3s ease; z-index:1200; display:flex; flex-direction:column; }
  .cart-header { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--border); }
  .cart-items { flex:1; overflow:auto; padding:12px 12px 0; }
  .cart-empty { padding:24px 16px; color:var(--mutetext); }
  .cart-item { display:grid; grid-template-columns:64px 1fr auto; gap:10px; padding:10px; border-bottom:1px solid var(--border); align-items:center; }
  .cart-item img { width:64px; height:64px; object-fit:cover; border-radius:8px; background:#1a1a1a10; }
  .cart-item h4 { margin:0 0 6px; font-size:14px; }
  .cart-item .meta { font-size:13px; color:var(--mutetext); }
  .qty { display:flex; align-items:center; gap:8px; }
  .qty button { width:28px; height:28px; border-radius:6px; border:1px solid var(--border); background:var(--card); color:var(--fg); cursor:pointer; }
  .remove { background:transparent; border:none; color:#c00; cursor:pointer; font-size:13px; }
  .cart-footer { border-top:1px solid var(--border); padding:12px 16px; }
  .cart-row { display:flex; align-items:center; justify-content:space-between; margin:8px 0; }
  .cart-actions { display:flex; gap:8px; margin-top:10px; }

  /* Admin modal */
  .admin-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:1300; }
  .admin-modal { width:100%; max-width:520px; background:var(--card); color:var(--fg); border-radius:14px; box-shadow:0 24px 64px rgba(0,0,0,.25); overflow:hidden; transform:translateY(12px); opacity:0; animation:fadeUp .25s ease forwards; }
  .admin-modal header { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border); }
  .admin-body { display:grid; gap:16px; padding:14px; }
  .admin-card { border:1px solid var(--border); border-radius:12px; background:var(--card); padding:12px; }
  .admin-card h4 { margin:0 0 10px; }
  .admin-card .row { display:grid; gap:8px; }
  .admin-card input { padding:10px 12px; border:1px solid var(--border); border-radius:8px; background:var(--card); color:var(--fg); }
  .admin-gate { display:grid; gap:8px; }
  .admin-badge { display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); }

  /* Checkout modal */
  .checkout-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:1400; }
  .checkout-modal { width:100%; max-width:560px; background:var(--card); color:var(--fg); border-radius:14px; box-shadow:0 24px 64px rgba(0,0,0,.25); overflow:hidden; transform:translateY(12px); opacity:0; animation:fadeUp .25s ease forwards; }
  .checkout-modal header { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border); }
  .checkout-body { display:grid; gap:14px; padding:14px; grid-template-columns:1fr; }
  @media (min-width: 720px) { .checkout-body { grid-template-columns:1fr 1fr; } }
  .ck-row { display:grid; gap:8px; }
  .ck-row input, .ck-row textarea, .ck-row select { padding:10px 12px; border:1px solid var(--border); border-radius:8px; font:inherit; background:var(--card); color:var(--fg); }
  .summary { border:1px solid var(--border); border-radius:12px; background:var(--card); padding:12px; }
  .summary h4 { margin:0 0 8px; }
  .summary .line { display:flex; justify-content:space-between; margin:4px 0; }
  .summary .items { max-height:180px; overflow:auto; border-top:1px dashed var(--border); margin-top:8px; padding-top:8px; font-size:14px; color:var(--mutetext); }

  /* Orders */
  .order-card { border:1px solid var(--border); border-radius:12px; background:var(--card); padding:12px; }
  .order-line { display:flex; justify-content:space-between; margin:4px 0; font-size:14px; }
  .order-items { margin-top:8px; font-size:13px; color:var(--mutetext); white-space:pre-line; display:none; }

  /* Celebration overlay */
  .celebrate-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:2000; }
  .celebrate-card { background:var(--card); color:var(--fg); border-radius:16px; padding:24px 20px; max-width:420px; width:92vw; text-align:center; box-shadow:0 18px 64px rgba(0,0,0,.25); animation:fadeUp .35s ease forwards; opacity:0; transform:translateY(10px); }
  .celebrate-title { font-size:20px; margin:10px 0 6px; }
  .celebrate-sub { color:var(--mutetext); }
  .checkwrap { width:96px; height:96px; margin:0 auto; position:relative; }
  .checkwrap svg { width:100%; height:100%; display:block; }
  .check-circle { stroke:#22c55e; stroke-width:6; fill:none; stroke-linecap:round; stroke-dasharray: 300; stroke-dashoffset: 300; animation:draw 0.6s ease forwards 0.1s; }
  .check-mark { stroke:#22c55e; stroke-width:6; fill:none; stroke-linecap:round; stroke-linejoin:round; stroke-dasharray: 50; stroke-dashoffset: 50; animation:draw 0.5s ease forwards 0.5s; }
  @keyframes draw { to { stroke-dashoffset: 0; } }
</style>

<script type="module" defer>
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, updateProfile, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
  import { getFirestore, collection, getDocs, query, limit, addDoc, serverTimestamp, doc, setDoc, getDoc, deleteDoc, where, orderBy } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  // Firebase config (provided)
  const firebaseConfig = {
    apiKey: "AIzaSyC5MGkOf5_0cF-xQrcA1PBSSvq6Y-AarSc",
    authDomain: "ds-mart-888d2.firebaseapp.com",
    projectId: "ds-mart-888d2",
    storageBucket: "ds-mart-888d2.firebasestorage.app",
    messagingSenderId: "108308848034",
    appId: "1:108308848034:web:a8b3fe5e8784a4771e66fb",
    measurementId: "G-KY618BJER7",
  };

  const app = initializeApp(firebaseConfig); // Firebase init. [12]
  const auth = getAuth(app);                 // Auth. [12]
  const db = getFirestore(app);              // Firestore. [3]

  // Elements
  const els = {
    productGrid: () => document.getElementById('productGrid'),
    categoryGrid: () => document.getElementById('categoryGrid'),
    search: () => document.getElementById('search'),
    cartCount: () => document.getElementById('cartCount'),
    loginBtn: () => document.getElementById('loginBtn'),
    myProfileBtn: () => document.getElementById('myProfileBtn'),
    adminBtn: () => document.getElementById('adminBtn'),
    openWishlist: () => document.getElementById('openWishlist'),
    themeToggle: () => document.getElementById('themeToggle'),
    userPill: () => document.getElementById('userPill'),
    userAvatar: () => document.getElementById('userAvatar'),
    userName: () => document.getElementById('userName'),
    contactForm: () => document.getElementById('contactForm'),
    sendBtn: () => document.getElementById('sendBtn'),

    accountModal: () => document.getElementById('accountModal'),
    closeAccount: () => document.getElementById('closeAccount'),
    tabLogin: () => document.getElementById('tabLogin'),
    tabSignup: () => document.getElementById('tabSignup'),
    tabProfile: () => document.getElementById('tabProfile'),
    tabOrders: () => document.getElementById('tabOrders'),
    tabWishlist: () => document.getElementById('tabWishlist'),
    panelLogin: () => document.getElementById('panelLogin'),
    panelSignup: () => document.getElementById('panelSignup'),
    panelProfile: () => document.getElementById('panelProfile'),
    panelOrders: () => document.getElementById('panelOrders'),
    panelWishlist: () => document.getElementById('panelWishlist'),
    alertBox: () => document.getElementById('alertBox'),
    formLogin: () => document.getElementById('formLogin'),
    formSignup: () => document.getElementById('formSignup'),
    formProfile: () => document.getElementById('formProfile'),
    doReset: () => document.getElementById('doReset'),
    doSignOut: () => document.getElementById('doSignOut'),

    openCart: () => document.getElementById('openCart'),
    cartDrawer: () => document.getElementById('cartDrawer'),
    cartBackdrop: () => document.getElementById('cartBackdrop'),
    cartItems: () => document.getElementById('cartItems'),
    cartSubtotal: () => document.getElementById('cartSubtotal'),
    closeCart: () => document.getElementById('closeCart'),
    clearCart: () => document.getElementById('clearCart'),
    checkoutBtn: () => document.getElementById('checkoutBtn'),

    adminBackdrop: () => document.getElementById('adminBackdrop'),
    closeAdmin: () => document.getElementById('closeAdmin'),
    adminCode: () => document.getElementById('adminCode'),
    unlockAdmin: () => document.getElementById('unlockAdmin'),
    adminState: () => document.getElementById('adminState'),
    productCard: () => document.getElementById('productCard'),
    categoryCard: () => document.getElementById('categoryCard'),
    formAddProduct: () => document.getElementById('formAddProduct'),
    formAddCategory: () => document.getElementById('formAddCategory'),

    checkoutBackdrop: () => document.getElementById('checkoutBackdrop'),
    closeCheckout: () => document.getElementById('closeCheckout'),
    checkoutForm: () => document.getElementById('checkoutForm'),
    placeOrderBtn: () => document.getElementById('placeOrderBtn'),
    ckItemsCount: () => document.getElementById('ckItemsCount'),
    ckSubtotal: () => document.getElementById('ckSubtotal'),
    ckTotal: () => document.getElementById('ckTotal'),
    ckItemsList: () => document.getElementById('ckItemsList'),

    celebrate: () => document.getElementById('celebrate'),
    celebrateMsg: () => document.getElementById('celebrateMsg'),
    celebrateClose: () => document.getElementById('celebrateClose'),

    ordersList: () => document.getElementById('ordersList'),
    wishlistList: () => document.getElementById('wishlistList'),
  };

  // Theme
  function applyTheme(t) { document.documentElement.setAttribute('data-theme', t); els.themeToggle().checked = (t === 'dark'); } // [1]
  function initTheme() { const t = localStorage.getItem('theme') || 'light'; applyTheme(t); } // [1]
  document.addEventListener('DOMContentLoaded', initTheme);
  els.themeToggle().addEventListener('change', () => {
    const t = els.themeToggle().checked ? 'dark' : 'light';
    localStorage.setItem('theme', t);
    applyTheme(t);
  }); // [1]

  // State
  let allProducts = [];
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  let wishlist = new Set();

  // Cart helpers
  function updateCartBadge() {
    const n = cart.reduce((s, i) => s + i.qty, 0);
    const badge = els.cartCount();
    badge.textContent = n;
    badge.classList.remove('pulse'); void badge.offsetWidth; badge.classList.add('pulse'); // [1]
  }
  function cartSave() { localStorage.setItem('cart', JSON.stringify(cart)); updateCartBadge(); renderCart(); } // [1]
  function addToCart(id) {
    const item = allProducts.find(p => p.id === id); if (!item) return;
    const existing = cart.find(c => c.id === id);
    if (existing) existing.qty += 1; else cart.push({ id: item.id, title: item.title, price: Number(item.price) || 0, imageUrl: item.imageUrl, qty: 1 });
    cartSave();
  }
  function incQty(id) { const it = cart.find(i => i.id === id); if (!it) return; it.qty += 1; cartSave(); }
  function decQty(id) { const it = cart.find(i => i.id === id); if (!it) return; it.qty = Math.max(0, it.qty - 1); if (it.qty === 0) cart = cart.filter(i => i.id !== id); cartSave(); }
  function removeItem(id) { cart = cart.filter(i => i.id !== id); cartSave(); }
  function clearCart() { cart = []; cartSave(); }
  function cartSubtotalValue() { return cart.reduce((sum, i) => sum + (Number(i.price) || 0) * (i.qty || 0), 0); }

  // Product card with wishlist heart
  function cardTemplate(p, wished) {
    return `
      <div class="card">
        <img src="${p.imageUrl}" alt="${p.title}" />
        <div class="info">
          <h3 style="margin:0 0 6px;font-size:16px">${p.title}</h3>
          <div class="price">₹${p.price}</div>
          <div style="display:flex;gap:8px;align-items:center">
            <button data-id="${p.id}" class="btn add">Add to cart</button>
            <button data-id="${p.id}" class="wish btn" title="Wishlist" style="${wished?'color:#e11d48;border-color:#e11d48':''}">❤</button>
          </div>
        </div>
      </div>
    `;
  } // [3]

  function renderProducts(list) {
    els.productGrid().innerHTML = list.map(p => cardTemplate(p, wishlist.has(p.id))).join('');
    els.productGrid().querySelectorAll('button').forEach(btn => {
      if (btn.classList.contains('wish')) {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id; const pd = allProducts.find(x => x.id === id);
          if (pd) toggleWishlist(id, pd);
        });
      } else {
        btn.addEventListener('click', () => addToCart(btn.dataset.id));
      }
    });
  } // [3]

  function renderCategories(list) {
    els.categoryGrid().innerHTML = list.map(c => `
      <div class="tile" data-slug="${c.slug}">
        <img src="${c.imageUrl}" alt="${c.name}" />
        <span>${c.name}</span>
      </div>
    `).join('');
    els.categoryGrid().querySelectorAll('.tile').forEach(tile => {
      tile.addEventListener('click', () => {
        const slug = tile.dataset.slug;
        const filtered = allProducts.filter(p => (p.category || '').toLowerCase() === slug.toLowerCase());
        renderProducts(filtered);
      });
    });
  } // [3]

  async function loadHome() {
    const catSnap = await getDocs(collection(db, 'categories')); // [3]
    renderCategories(catSnap.docs.map(d => ({ id: d.id, ...d.data() })));
    const qref = query(collection(db, 'products'), limit(20));   // [3]
    const prodSnap = await getDocs(qref);
    allProducts = prodSnap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderProducts(allProducts);
  }

  // Search
  document.addEventListener('DOMContentLoaded', () => {
    els.search().addEventListener('input', e => {
      const q = e.target.value.trim().toLowerCase();
      const filtered = allProducts.filter(p => p.title.toLowerCase().includes(q) || (p.category || '').toLowerCase().includes(q));
      renderProducts(filtered);
    });
  });

  // Account modal
  function openAccount() { els.accountModal().style.display = 'flex'; els.accountModal().setAttribute('aria-hidden','false'); }
  function closeAccount() { els.accountModal().style.display = 'none'; els.accountModal().setAttribute('aria-hidden','true'); }
  els.loginBtn().addEventListener('click', openAccount);
  els.closeAccount().addEventListener('click', closeAccount);
  els.accountModal().addEventListener('click', (e) => { if (e.target === els.accountModal()) closeAccount(); });

  // Tabs
  function setTab(name) {
    const tabs = [els.tabLogin(), els.tabSignup(), els.tabProfile(), els.tabOrders(), els.tabWishlist()];
    const panels = [els.panelLogin(), els.panelSignup(), els.panelProfile(), els.panelOrders(), els.panelWishlist()];
    tabs.forEach(b => b && b.classList.remove('active'));
    panels.forEach(p => p && p.classList.remove('active'));
    const map = { login:'tabLogin', signup:'tabSignup', profile:'tabProfile', orders:'tabOrders', wishlist:'tabWishlist' };
    const pmap = { login:'panelLogin', signup:'panelSignup', profile:'panelProfile', orders:'panelOrders', wishlist:'panelWishlist' };
    const tb = els[map[name]] && els[map[name]](); const pn = els[pmap[name]] && els[pmap[name]]();
    if (tb) tb.classList.add('active'); if (pn) pn.classList.add('active');
  } // [3]
  function openProfile() { openAccount(); setTab('profile'); } // [3]
  document.addEventListener('DOMContentLoaded', () => {
    els.tabOrders() && els.tabOrders().addEventListener('click', () => { setTab('orders'); loadMyOrders(); });
    els.tabWishlist() && els.tabWishlist().addEventListener('click', () => { setTab('wishlist'); loadMyWishlist(); });
    els.myProfileBtn() && els.myProfileBtn().addEventListener('click', openProfile);
    els.openWishlist() && els.openWishlist().addEventListener('click', () => { openAccount(); setTab('wishlist'); loadMyWishlist(); });
  });

  function showAlert(msg) { const box = els.alertBox(); box.textContent = msg; box.classList.add('show'); setTimeout(()=>box.classList.remove('show'), 3500); }

  // Hide/show Login & Sign up tabs on auth
  function hideAuthTabs() {
    const tLogin = els.tabLogin && els.tabLogin();
    const tSignup = els.tabSignup && els.tabSignup();
    const pLogin = els.panelLogin && els.panelLogin();
    const pSignup = els.panelSignup && els.panelSignup();
    if (tLogin) tLogin.style.display = 'none';
    if (tSignup) tSignup.style.display = 'none';
    if (pLogin) pLogin.style.display = 'none';
    if (pSignup) pSignup.style.display = 'none';
    const activeLogin = tLogin && tLogin.classList.contains('active');
    const activeSignup = tSignup && tSignup.classList.contains('active');
    if (activeLogin || activeSignup) setTab('profile'); // [3]
  }
  function showAuthTabs() {
    const tLogin = els.tabLogin && els.tabLogin();
    const tSignup = els.tabSignup && els.tabSignup();
    const pLogin = els.panelLogin && els.panelLogin();
    const pSignup = els.panelSignup && els.panelSignup();
    if (tLogin) tLogin.style.display = '';
    if (tSignup) tSignup.style.display = '';
    if (pLogin) pLogin.style.display = '';
    if (pSignup) pSignup.style.display = '';
    setTab('login'); // [3]
  }

  // Firestore user profile upsert
  async function upsertUserProfile(user) {
    if (!user) return;
    const ref = doc(db, 'users', user.uid);
    const snap = await getDoc(ref);
    const base = { uid: user.uid, email: user.email || null, displayName: user.displayName || null, photoURL: user.photoURL || null, updatedAt: serverTimestamp() };
    if (!snap.exists()) await setDoc(ref, { ...base, createdAt: serverTimestamp() }); else await setDoc(ref, base, { merge: true }); // [3]
  }

  // Header user pill
  function updateUserPill(user) {
    if (!user) { els.userPill().style.display='none'; return; }
    els.userPill().style.display = '';
    const name = user.displayName || (user.email ? user.email.split('@') : 'Me');
    els.userName().textContent = name;
    const ph = user.photoURL || 'https://ui-avatars.com/api/?background=0D8ABC&color=fff&name=' + encodeURIComponent(name);
    els.userAvatar().src = ph;
    els.userPill().onclick = () => { openAccount(); setTab('profile'); };
  } // [3]

  // Auth flows
  els.formLogin().addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = new FormData(els.formLogin());
    const email = data.get('email'); const password = data.get('password');
    try {
      await signInWithEmailAndPassword(auth, email, password); // [12]
      await upsertUserProfile(auth.currentUser);               // [3]
      openProfile();
      showAlert('Logged in');
    } catch (err) { showAlert(err.message); }
  });

  els.formSignup().addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = new FormData(els.formSignup());
    const name = (data.get('name') || '').toString();
    const email = data.get('email'); const password = data.get('password');
    try {
      const cred = await createUserWithEmailAndPassword(auth, email, password); // [12]
      if (name) await updateProfile(cred.user, { displayName: name });         // [3]
      await upsertUserProfile(cred.user);                                      // [3]
      openProfile();
      showAlert('Account created');
    } catch (err) { showAlert(err.message); }
  });

  els.doReset().addEventListener('click', async () => {
    const email = (new FormData(els.formLogin()).get('email') || '').toString();
    if (!email) { showAlert('Enter email in login form first'); return; }
    try { await sendPasswordResetEmail(auth, email); showAlert('Password reset email sent'); } catch (err) { showAlert(err.message); } // [12]
  });

  els.formProfile().addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = new FormData(els.formProfile());
    const displayName = (data.get('displayName') || '').toString() || null;
    const photoURL = (data.get('photoURL') || '').toString() || null;
    const user = auth.currentUser; if (!user) { showAlert('Not signed in'); return; }
    try {
      await updateProfile(user, { displayName, photoURL });                    // [3]
      await upsertUserProfile({ ...user, displayName, photoURL });            // [3]
      document.querySelector('#panelProfile [name="displayName"]').value = displayName || '';
      document.querySelector('#panelProfile [name="photoURL"]').value = photoURL || '';
      updateUserPill({ ...user, displayName, photoURL });
      showAlert('Profile updated');
    } catch (err) { showAlert(err.message); }
  });

  els.doSignOut().addEventListener('click', async () => {
    await signOut(auth); showAlert('Signed out'); showAuthTabs(); setTab('login'); setAdmin(false); // [12][3]
  });

  // Wishlist
  function userWishlistCol() { const u = auth.currentUser; if (!u) return null; return collection(db, 'users', u.uid, 'wishlist'); } // [3]
  async function loadMyWishlist() {
    const col = userWishlistCol(); if (!col) { wishlist = new Set(); renderWishlistPanel(); return; }
    const snap = await getDocs(col); wishlist = new Set(snap.docs.map(d => d.id)); renderWishlistPanel();
  } // [3]
  async function toggleWishlist(productId, productData) {
    const col = userWishlistCol(); if (!col) { alert('Sign in to use wishlist'); return; }
    const ref = doc(db, 'users', auth.currentUser.uid, 'wishlist', productId);
    if (wishlist.has(productId)) { await deleteDoc(ref); wishlist.delete(productId); }
    else {
      await setDoc(ref, { id: productId, title: productData.title, price: Number(productData.price)||0, imageUrl: productData.imageUrl || null, category: productData.category || null, addedAt: serverTimestamp() });
      wishlist.add(productId);
    }
    renderProducts(allProducts); renderWishlistPanel();
  } // [3]
  function renderWishlistPanel() {
    const items = allProducts.filter(p => wishlist.has(p.id));
    els.wishlistList().innerHTML = items.length ? items.map(p => cardTemplate(p, true)).join('') : '<div class="muted">No items in wishlist.</div>';
    els.wishlistList().querySelectorAll('button').forEach(btn => {
      if (btn.classList.contains('wish')) {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id; const pd = allProducts.find(x => x.id === id);
          if (pd) toggleWishlist(id, pd);
        });
      } else {
        btn.addEventListener('click', () => addToCart(btn.dataset.id));
      }
    });
  } // [3]

  // Orders: robust loader with details and error handling
  async function loadMyOrders() {
    const listEl = els.ordersList();
    if (!auth.currentUser) {
      listEl.innerHTML = '<div class="muted">Sign in to see orders.</div>';
      return;
    }
    listEl.innerHTML = '<div class="muted">Loading orders…</div>';
    try {
      const qref = query(
        collection(db, 'orders'),
        where('userId', '==', auth.currentUser.uid),
        orderBy('createdAt', 'desc')
      ); // Requires composite index if prompted. [3][1]
      const snap = await getDocs(qref);
      if (snap.empty) {
        listEl.innerHTML = '<div class="muted">No orders yet.</div>';
        return;
      }
      listEl.innerHTML = snap.docs.map(d => {
        const o = d.data();
        const createdAt =
          (o.createdAt && o.createdAt.toDate && o.createdAt.toDate()) ?
            o.createdAt.toDate().toLocaleString() : '';
        const items = Array.isArray(o.items) ? o.items : [];
        const itemsText = items.map(i =>
          `${i.title} × ${i.qty} = ₹${(Number(i.price)||0) * (i.qty||0)}`
        ).join('\n');
        return `
          <div class="order-card" data-id="${d.id}">
            <div class="order-line"><span>Order ID</span><strong>${d.id}</strong></div>
            <div class="order-line"><span>Date</span><strong>${createdAt}</strong></div>
            <div class="order-line"><span>Status</span><strong>${o.status || 'pending'}</strong></div>
            <div class="order-line"><span>Total</span><strong>₹${o.total ?? o.subtotal ?? 0}</strong></div>
            <div class="order-items">${itemsText}</div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn toggle-items">View details</button>
              <button class="btn" onclick="navigator.clipboard && navigator.clipboard.writeText('${d.id}')">Copy ID</button>
            </div>
          </div>
        `;
      }).join('');
      // Wire expand/collapse
      listEl.querySelectorAll('.order-card .toggle-items').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const card = e.target.closest('.order-card');
          const details = card.querySelector('.order-items');
          const show = details.style.display !== 'block';
          details.style.display = show ? 'block' : 'none';
          btn.textContent = show ? 'Hide details' : 'View details';
        });
      });
    } catch (err) {
      console.error(err);
      listEl.innerHTML = '<div class="muted">Failed to load orders. Please try again.</div>';
    }
  } // [3][1]

  // Auth listener: toggle header, pill, wishlist, and auth tabs
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      await upsertUserProfile(user);                       // [3]
      els.loginBtn().style.display = 'none';
      els.adminBtn().style.display = 'none';
      els.myProfileBtn().style.display = '';
      updateUserPill(user);                                // [3]
      await loadMyWishlist();                              // [3]
      hideAuthTabs();                                      // [3]
    } else {
      els.loginBtn().style.display = '';
      els.adminBtn().style.display = '';
      els.myProfileBtn().style.display = 'none';
      updateUserPill(null); wishlist = new Set(); renderProducts(allProducts); // [3]
      showAuthTabs();                                      // [3]
    }
  });

  // EmailJS contact
  window.addEventListener('load', () => {
    const form = els.contactForm(); const btn = els.sendBtn();
    form.addEventListener('submit', async (e) => {
      e.preventDefault(); btn.classList.add('loading');
      try { await emailjs.sendForm('service_c4p68ag', 'template_214uijp', form); form.reset(); alert('Message sent!'); } // [11]
      catch (err) { console.error(err); alert('Failed to send.'); }
      finally { btn.classList.remove('loading'); }
    });
  });

  // Cart drawer
  function openCartDrawer() { els.cartDrawer().style.transform = 'translateX(0)'; els.cartDrawer().setAttribute('aria-hidden','false'); els.cartBackdrop().style.display = 'block'; }
  function closeCartDrawer() { els.cartDrawer().style.transform = 'translateX(100%)'; els.cartDrawer().setAttribute('aria-hidden','true'); els.cartBackdrop().style.display = 'none'; }
  function renderCart() {
    if (cart.length === 0) { els.cartItems().innerHTML = '<div class="cart-empty">Cart is empty.</div>'; els.cartSubtotal().textContent = '₹0'; return; }
    els.cartItems().innerHTML = cart.map(i => `
      <div class="cart-item">
        <img src="${i.imageUrl}" alt="${i.title}" />
        <div>
          <h4>${i.title}</h4>
          <div class="meta">₹${i.price} × ${i.qty} = ₹${(Number(i.price)||0)*i.qty}</div>
          <div class="qty">
            <button data-id="${i.id}" class="qty-dec">−</button>
            <span>${i.qty}</span>
            <button data-id="${i.id}" class="qty-inc">+</button>
            <button data-id="${i.id}" class="remove">Remove</button>
          </div>
        </div>
        <strong>₹${(Number(i.price)||0)*i.qty}</strong>
      </div>
    `).join('');
    els.cartSubtotal().textContent = `₹${cartSubtotalValue()}`;
    els.cartItems().querySelectorAll('.qty-inc').forEach(b => b.addEventListener('click', () => incQty(b.dataset.id)));
    els.cartItems().querySelectorAll('.qty-dec').forEach(b => b.addEventListener('click', () => decQty(b.dataset.id)));
    els.cartItems().querySelectorAll('.remove').forEach(b => b.addEventListener('click', () => removeItem(b.dataset.id)));
  }
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('openCart').addEventListener('click', openCartDrawer);
    document.getElementById('closeCart').addEventListener('click', closeCartDrawer);
    document.getElementById('cartBackdrop').addEventListener('click', closeCartDrawer);
    document.getElementById('clearCart').addEventListener('click', clearCart);
    document.getElementById('checkoutBtn').addEventListener('click', openCheckout);
  });

  // Admin session (client-side gate)
  const ADMIN_SESSION_KEY = 'isAdmin';
  function isAdmin() { return localStorage.getItem(ADMIN_SESSION_KEY) === 'true'; }
  function setAdmin(v) { localStorage.setItem(ADMIN_SESSION_KEY, v ? 'true' : 'false'); syncAdminUI(); }
  function openAdmin() { els.adminBackdrop().style.display = 'flex'; els.adminBackdrop().setAttribute('aria-hidden','false'); syncAdminUI(); }
  function closeAdminModal() { els.adminBackdrop().style.display = 'none'; els.adminBackdrop().setAttribute('aria-hidden','true'); }
  document.getElementById('adminBtn').addEventListener('click', openAdmin);
  document.getElementById('closeAdmin').addEventListener('click', closeAdminModal);
  document.getElementById('adminBackdrop').addEventListener('click', (e) => { if (e.target === els.adminBackdrop()) closeAdminModal(); });
  function syncAdminUI() {
    const unlocked = isAdmin();
    els.adminState().textContent = unlocked ? 'Unlocked' : 'Locked';
    els.adminState().style.color = unlocked ? '#0a7' : '#92400e';
    els.productCard().style.display = unlocked ? '' : 'none';
    els.categoryCard().style.display = unlocked ? '' : 'none';
  }
  els.unlockAdmin().addEventListener('click', () => {
    const code = (els.adminCode().value || '').trim();
    if (code === '741223') { setAdmin(true); alert('Admin unlocked'); } else { alert('Invalid code'); }
  }); // [3]

  // Admin: Add product
  document.getElementById('formAddProduct').addEventListener('submit', async (e) => {
    e.preventDefault(); if (!isAdmin()) { alert('Admin locked'); return; }
    const fd = new FormData(e.currentTarget);
    const data = { title: (fd.get('title')||'').toString(), price: Number(fd.get('price')||0), imageUrl: (fd.get('imageUrl')||'').toString(), category: (fd.get('category')||'').toString(), stock: parseInt(fd.get('stock')||'0',10), createdAt: Date.now() };
    try { await addDoc(collection(db,'products'), data); alert('Product added'); e.currentTarget.reset(); loadHome(); } // [3]
    catch (err) { console.error(err); alert('Failed to add product'); }
  });

  // Admin: Add category
  document.getElementById('formAddCategory').addEventListener('submit', async (e) => {
    e.preventDefault(); if (!isAdmin()) { alert('Admin locked'); return; }
    const fd = new FormData(e.currentTarget);
    const data = { name:(fd.get('name')||'').toString(), slug:(fd.get('slug')||'').toString(), imageUrl:(fd.get('imageUrl')||'').toString(), createdAt: Date.now() };
    try { await addDoc(collection(db,'categories'), data); alert('Category added'); e.currentTarget.reset(); loadHome(); } // [3]
    catch (err) { console.error(err); alert('Failed to add category'); }
  });

  // Checkout modal and order placement
  function openCheckout() {
    if (!auth.currentUser) { alert('Sign in to continue to checkout.'); return; } // [12]
    if (!cart || cart.length === 0) { alert('Cart is empty.'); return; }          // [3]
    els.checkoutForm().querySelector('[name="email"]').value = auth.currentUser.email || '';
    const subtotal = cartSubtotalValue();
    els.ckItemsCount().textContent = cart.reduce((s,i)=>s+(i.qty||0),0);
    els.ckSubtotal().textContent = `₹${subtotal}`;
    els.ckTotal().textContent = `₹${subtotal}`;
    els.ckItemsList().innerHTML = cart.map(i => `${i.title} — ₹${i.price} × ${i.qty}`).join('<br/>');
    els.checkoutBackdrop().style.display = 'flex'; els.checkoutBackdrop().setAttribute('aria-hidden','false');
  }
  function closeCheckoutModal() { els.checkoutBackdrop().style.display = 'none'; els.checkoutBackdrop().setAttribute('aria-hidden','true'); }
  els.closeCheckout().addEventListener('click', closeCheckoutModal);
  els.checkoutBackdrop().addEventListener('click', (e) => { if (e.target === els.checkoutBackdrop()) closeCheckoutModal(); });

  // Celebration helpers
  function showCelebration(message) {
    if (message) els.celebrateMsg().textContent = message;
    els.celebrate().style.display = 'flex'; els.celebrate().setAttribute('aria-hidden','false');
    setTimeout(() => { if (window.confetti) {
      confetti({ particleCount: 120, startVelocity: 35, spread: 70, origin: { x: 0.5, y: 0.4 } });
      confetti({ particleCount: 80, angle: 60, spread: 50, origin: { x: 0 } });
      confetti({ particleCount: 80, angle: 120, spread: 50, origin: { x: 1 } });
    }}, 150);
  }
  function hideCelebration() { els.celebrate().style.display = 'none'; els.celebrate().setAttribute('aria-hidden','true'); }
  els.celebrateClose().addEventListener('click', hideCelebration);
  els.celebrate().addEventListener('click', (e)=>{ if (e.target === els.celebrate()) hideCelebration(); });

  // Place order
  els.checkoutForm().addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!auth.currentUser) { alert('Not signed in.'); return; } // [12]
    if (!cart || cart.length === 0) { alert('Cart is empty.'); return; } // [3]

    const fd = new FormData(els.checkoutForm());
    const payload = {
      userId: auth.currentUser.uid,
      email: (fd.get('email') || '').toString(),
      fullName: (fd.get('fullName') || '').toString(),
      phone: (fd.get('phone') || '').toString(),
      address: (fd.get('address') || '').toString(),
      payment: (fd.get('payment') || '').toString(),
      currency: 'INR',
      items: cart.map(i => ({ id: i.id, title: i.title, price: Number(i.price)||0, qty: i.qty||0, imageUrl: i.imageUrl })),
      subtotal: cartSubtotalValue(),
      shipping: 0,
      total: cartSubtotalValue(),
      status: 'pending',
      createdAt: serverTimestamp(),
      updatedAt: serverTimestamp(),
    };

    els.placeOrderBtn().classList.add('loading');

    try {
      const ref = await addDoc(collection(db, 'orders'), payload); // [3]
      const orderId = ref.id;
      try {
        const itemsText = payload.items.map(i => `${i.title} x${i.qty} = ₹${i.price * i.qty}`).join('\n');
        await emailjs.send('service_c4p68ag', 'template_214uijp', { name: payload.fullName, email: payload.email, order_id: orderId, items_text: itemsText, total: `₹${payload.total}` }); // [11]
      } catch (emailErr) { console.warn('Email send failed (continuing):', emailErr); }
      cart = []; localStorage.setItem('cart', JSON.stringify(cart)); updateCartBadge(); renderCart(); closeCheckoutModal(); showCelebration(`Order ID: ${orderId}`);
      // Prefetch orders so the Orders tab is ready
      loadMyOrders(); // [13]
    } catch (err) { console.error(err); alert('Failed to place order. Please try again.'); }
    finally { els.placeOrderBtn().classList.remove('loading'); }
  });

  // Bootstrap
  updateCartBadge(); renderCart(); loadHome(); // [3]
</script>

<!-- EmailJS SDK + init -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js" defer></script>
<script defer>
  window.addEventListener('load', () => { emailjs.init('E8cAV9p-pSYDnM8kE'); }); /* EmailJS public key */ <!-- [11] -->
</script>
<!-- Canvas Confetti CDN -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js" defer></script>
</head>
<body>
  <header class="header">
    <div class="logo">Shopsy</div>
    <div class="search"><input id="search" placeholder="Search products..." /></div>
    <nav>
      <button id="loginBtn" class="btn">Login</button>
      <button id="myProfileBtn" class="btn" style="display:none">My Profile</button>
      <button id="adminBtn" class="btn">Admin</button>
      <button id="openCart" class="btn cart-toggle">Cart <span id="cartCount" class="badge">0</span></button>
      <button id="openWishlist" class="btn" title="My Wishlist">❤</button>
      <label style="display:flex;align-items:center;gap:6px;margin-left:8px">
        <input id="themeToggle" type="checkbox" />
        <span>Dark</span>
      </label>
      <div id="userPill" class="btn" style="display:none;gap:8px;align-items:center">
        <img id="userAvatar" alt="avatar" style="width:22px;height:22px;border-radius:50%;object-fit:cover" />
        <span id="userName"></span>
      </div>
    </nav>
  </header>

  <section class="hero">
    <h1>Big Savings, Daily</h1>
    <p class="muted">Discover deals across fashion, electronics, and more.</p>
  </section>

  <section>
    <h2 style="padding:0 16px;margin:16px 0 0">Categories</h2>
    <div id="categoryGrid" class="grid"></div>
  </section>

  <section>
    <h2 style="padding:0 16px;margin:16px 0 0">Featured</h2>
    <div id="productGrid" class="grid"></div>
  </section>

  <section class="contact">
    <h2>Contact</h2>
    <form id="contactForm">
      <input name="from_name" placeholder="Name" required />
      <input name="reply_to" type="email" placeholder="Email" required />
      <textarea name="message" placeholder="Message" required></textarea>
      <button id="sendBtn" class="btn primary" type="submit">
        <span class="txt">Send</span>
        <span class="spinner" aria-hidden="true"></span>
      </button>
    </form>
  </section>

  <!-- Account Modal -->
  <div id="accountModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <header>
        <h3>Account</h3>
        <button class="close" aria-label="Close" id="closeAccount">×</button>
      </header>

      <div class="tabs">
        <button id="tabLogin" class="active">Log in</button>
        <button id="tabSignup">Sign up</button>
        <button id="tabProfile">Profile</button>
        <button id="tabOrders">Orders</button>
        <button id="tabWishlist">Wishlist</button>
      </div>

      <div id="alertBox" class="alert"></div>

      <section id="panelLogin" class="panel active">
        <form id="formLogin" class="row">
          <input name="email" type="email" placeholder="Email" required />
          <input name="password" type="password" placeholder="Password" required />
          <button class="btn primary" type="submit">Log in</button>
        </form>
        <button id="doReset" class="btn" type="button">Forgot password?</button>
      </section>

      <section id="panelSignup" class="panel">
        <form id="formSignup" class="row">
          <input name="name" placeholder="Full name" />
          <input name="email" type="email" placeholder="Email" required />
          <input name="password" type="password" placeholder="Password (6+)" required />
          <button class="btn primary" type="submit">Create account</button>
        </form>
        <p class="muted">By continuing, an account will be created with email/password authentication.</p>
      </section>

      <section id="panelProfile" class="panel">
        <form id="formProfile" class="row">
          <input name="displayName" placeholder="Display name" />
          <input name="photoURL" type="url" placeholder="Photo URL (https://...)" />
          <button class="btn primary" type="submit">Save profile</button>
        </form>
        <button id="doSignOut" class="btn" type="button">Sign out</button>
      </section>

      <section id="panelOrders" class="panel">
        <div id="ordersList" class="row" style="gap:12px"></div>
      </section>

      <section id="panelWishlist" class="panel">
        <div id="wishlistList" class="grid"></div>
      </section>
    </div>
  </div>

  <!-- Cart Drawer -->
  <div id="cartDrawer" class="cart-drawer" aria-hidden="true">
    <div class="cart-header">
      <strong>Cart</strong>
      <button id="closeCart" class="btn">Close</button>
    </div>
    <div id="cartItems" class="cart-items"></div>
    <div class="cart-footer">
      <div class="cart-row">
        <span>Subtotal</span>
        <strong id="cartSubtotal">₹0</strong>
      </div>
      <div class="cart-actions">
        <button id="clearCart" class="btn">Clear</button>
        <button id="checkoutBtn" class="btn primary" style="flex:1">Checkout</button>
      </div>
    </div>
  </div>
  <div id="cartBackdrop" class="cart-drawer-backdrop"></div>

  <!-- Admin Modal -->
  <div id="adminBackdrop" class="admin-backdrop" aria-hidden="true">
    <div class="admin-modal">
      <header>
        <h3>Admin</h3>
        <button id="closeAdmin" class="close" aria-label="Close">×</button>
      </header>
      <div class="admin-body">
        <div class="admin-card" id="adminGateCard">
          <h4>Unlock Admin</h4>
          <div class="admin-gate">
            <input id="adminCode" placeholder="Enter admin code" />
            <button id="unlockAdmin" class="btn primary">Unlock</button>
            <span id="adminState" class="admin-badge">Locked</span>
          </div>
          <p class="muted">Client-side gate only; use Firestore Rules + custom claims to secure writes in production.</p>
        </div>

        <div class="admin-card" id="productCard" style="display:none">
          <h4>Add Product</h4>
          <form id="formAddProduct" class="row">
            <input name="title" placeholder="Title" required />
            <input name="price" type="number" step="0.01" placeholder="Price" required />
            <input name="imageUrl" type="url" placeholder="Image URL" required />
            <input name="category" placeholder="Category slug (e.g., fashion)" required />
            <input name="stock" type="number" step="1" placeholder="Stock (e.g., 20)" required />
            <button class="btn primary" type="submit">Add product</button>
          </form>
        </div>

        <div class="admin-card" id="categoryCard" style="display:none">
          <h4>Add Category</h4>
          <form id="formAddCategory" class="row">
            <input name="name" placeholder="Name (e.g., Fashion)" required />
            <input name="slug" placeholder="Slug (e.g., fashion)" required />
            <input name="imageUrl" type="url" placeholder="Image URL" required />
            <button class="btn primary" type="submit">Add category</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Checkout Modal -->
  <div id="checkoutBackdrop" class="checkout-backdrop" aria-hidden="true">
    <div class="checkout-modal">
      <header>
        <h3>Checkout</h3>
        <button id="closeCheckout" class="close" aria-label="Close">×</button>
      </header>
      <div class="checkout-body">
        <form id="checkoutForm" class="ck-row">
          <input name="fullName" placeholder="Full name" required />
          <input name="email" type="email" placeholder="Email for updates" required />
          <input name="phone" type="tel" placeholder="Phone" required />
          <textarea name="address" placeholder="Shipping address" rows="4" required></textarea>
          <select name="payment" required>
            <option value="cod">Cash on Delivery</option>
          </select>
          <button id="placeOrderBtn" class="btn primary" type="submit">
            <span class="txt">Place order</span>
            <span class="spinner" aria-hidden="true"></span>
          </button>
        </form>

        <div class="summary">
          <h4>Order summary</h4>
          <div class="line"><span>Items</span><strong id="ckItemsCount">0</strong></div>
          <div class="line"><span>Subtotal</span><strong id="ckSubtotal">₹0</strong></div>
          <div class="line"><span>Shipping</span><strong>₹0</strong></div>
          <div class="line"><span>Total</span><strong id="ckTotal">₹0</strong></div>
          <div id="ckItemsList" class="items"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Celebration Overlay -->
  <div id="celebrate" class="celebrate-backdrop" aria-hidden="true">
    <div class="celebrate-card">
      <div class="checkwrap" aria-hidden="true">
        <svg viewBox="0 0 120 120">
          <circle class="check-circle" cx="60" cy="60" r="50"></circle>
          <polyline class="check-mark" points="38,62 54,78 84,46"></polyline>
        </svg>
      </div>
      <div class="celebrate-title">Order placed!</div>
      <div id="celebrateMsg" class="celebrate-sub">Thanks for the purchase.</div>
      <div style="margin-top:14px">
        <button id="celebrateClose" class="btn primary">Continue shopping</button>
      </div>
    </div>
  </div>

  <footer>© 2025 Shopsy demo</footer>
</body>
</html>
